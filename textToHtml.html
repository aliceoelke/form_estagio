<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <title>Descrição do conteúdo</title>
        <style>
            .conteudo {
                margin: auto;
                max-width: 95%;
                width: 1200px;
            }
            .conteudo form.conteudocatg,
            .input-field.col.s12.conteudocatg {
                border: 1px solid #eee;
                border-radius: 4px;
                background-color: #fff;
                -webkit-box-shadow: 0 5px 5px 0 #ddd;
                box-shadow: 0 5px 5px 0 #ddd;
                padding: 20px;
                margin-top: 0;
            }
            #codigohtml {
                min-height: 500px;
                border: none;
                overflow-y: scroll;
            }
            .input-field.col.s12.conteudocatg {
                display: none;
            }
            .input-field.col.s12.conteudocatg.codEfeito {
                display: block;
            }
            .linksdotexto {
                border: 2px solid #000;
                float: left;
                border-radius: 4px;
                width: 100%;
                margin-bottom: 5px;
            }
            .conteudocatg textarea.materialize-textarea {
                z-index: 5000;
                margin: 0;
            }
            .mais-info {
                display: none;
            }
            .mais-info.conteudo-open {
                display: block;
            }
            .waves-effect.waves-light.btn.close {
                display: none;
            }
            span.btn {
                margin: 0 5px 5px;
                font-size: 12;
                padding: 0 6px;
            }
            .linksdotexto #calcular {
                margin: 10px;
            }
        </style>
    </head>
    <body>
        <div class="conteudo">
            <h3>Montando um html</h3>
            <div class="row">
                <form class="conteudocatg col s12">
                    <div class="row">
                        <div class="input-field col s12">
                            <textarea class="materialize-textarea" name="" id="title"></textarea>
                            <label for="titulo">Títulos:</label>
                            <span class="helper-text exemplos">Ex.:H2 / Mesa de centro | H3 / Acabamento e limpeza</span>
                        </div>
                        <div class="linksdotexto">
                            <div class="input-field col s8">                        
                                <textarea class="materialize-textarea" name="" id="negrito"></textarea>
                                <label for="negrito">Palavras em <strong>negrito</strong>:</label>
                                <span class="helper-text exemplos">Ex.:solteiro | cama | móvel</span>
                            </div>
                            <div class="input-field col s4">
                                <textarea class="materialize-textarea" name="" id="numPgfNegrito"></textarea>
                                <label for="numParagrafoNegrito">Nº Paragrafo:</label>
                                <span class="helper-text exemplos">Ex.:1 | 3 | 4</span>
                            </div>
                        </div>
                        <div class="linksdotexto">
                            <div class="input-field col s12">
                                <textarea class="materialize-textarea" name="" id="link"></textarea>
                                <label for="link">Links:</label>
                                <span class="helper-text exemplos">Ex.:https://www.marabraz.com.br/ | https://www.marabraz.com.br/quarto.html</span>
                            </div>             
                            <div class="input-field col s8">
                                <textarea class="materialize-textarea" name="" id="palavra"></textarea>
                                <label for="palavra">Palavra:</label>
                                <span class="helper-text exemplos">Ex.:Marabraz | quarto</span>
                            </div>
                            <span class="waves-effect waves-light btn" data-mais="1">Mais opções</span>
                            <div class="mais-info" data-conteudo="1">
                                <div class="input-field col s4">
                                    <textarea class="materialize-textarea" name="" id="numPgfLink"></textarea>
                                    <label for="numParagrafoLink">Nº Paragrafo:</label>
                                    <span class="helper-text exemplos">Ex.: 2 | 2</span>
                                </div>
                                <div class="input-field col s12">
                                    <textarea class="materialize-textarea" name="" id="atributos"></textarea>
                                    <label for="atributos">Atributos do link:</label>
                                    <span class="helper-text exemplos">Ex.:nofollow | follow</span>
                                </div>
                            </div>
                        </div>
                        <span class="waves-effect waves-light btn" data-mais="2">Mais opções</span>
                        <div class="mais-info" data-conteudo="2">
                            <div class="input-field col s12">
                                <textarea class="materialize-textarea" name="" id="italic"></textarea>
                                <label for="italico">Palavras em <span style="font-style: italic;">italico</span>:</label>
                                <span class="helper-text exemplos">Ex.: <span style="font-style: italic;">Selfie</span></span>
                            </div>
                            <div class="input-field col s12">
                                <textarea class="materialize-textarea" name="" id="list"></textarea>
                                <label for="lista">Lista com marcadores:</label>
                                <span class="helper-text exemplos">Ex.:Altura: 101 cm; | Largura: 100 cm; | Profundidade: 202 cm.</span>
                            </div>
                            <div class="linksdotexto">
                                <div class="input-field col s12">
                                    <textarea class="materialize-textarea" name="" id="densidade"></textarea>
                                    <label for="densidade">Densidade das palavras:</label>
                                </div>
                                <div class="input-field col s12">
                                    <textarea class="materialize-textarea" name="" id="totalpalavras"></textarea>
                                    <label for="totalpalavras">Total das palavras:</label>
                                </div>
                                <button id="calcular" class="waves-effect waves-light btn">Calcular</button>
                            </div>
                        </div>                        
                        <div class="input-field col s12">
                            <textarea class="materialize-textarea" name="" id="text"></textarea>
                            <label for="texto">Descrição:</label>
                        </div>
                    </div>
                    <p>
                        <label>
                            <input type="checkbox" id="produto"/>
                            <span>Html para a pág Produto</span>
                        </label>
                    </p>
                    <p>*Separa todos os elementos por |</p>
                    <button id="buttonConverter" class="waves-effect waves-light btn">Converter</button>
                    <button disabled id="buttonLimpar" class="waves-effect waves-light btn">Limpar campos</button>
                </form>
                <div class="col s12">
                    <div class="input-field col s12 conteudocatg">
                        <textarea class="materialize-textarea" name="" id="codigohtml"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="https://cdn.rawgit.com/beautify-web/js-beautify/v1.10.3/js/lib/beautify.js"></script>
        <script src="https://cdn.rawgit.com/beautify-web/js-beautify/v1.10.3/js/lib/beautify-css.js"></script>
        <script src="https://cdn.rawgit.com/beautify-web/js-beautify/v1.10.3/js/lib/beautify-html.js"></script>
        <script>
            var doc = document;
            var titles = doc.getElementById('title'),
                palvNegritas = doc.getElementById('negrito'),
                numPalvNegritas = doc.getElementById('numPgfNegrito'),
                listademarcadores = doc.getElementById('list'),
                palvItalicas = doc.getElementById('italic'),
                href = doc.getElementById('link'),
                palavraslink = doc.getElementById('palavra'),
                numParagfLink = doc.getElementById('numPgfLink'),
                descricao = doc.getElementById('text'),
                atributoslink = doc.getElementById('atributos'),
                densidade = doc.getElementById('densidade'),
                totalpalavras = doc.getElementById('totalpalavras');
            var ptrp;

            var mensagemerro = document.querySelectorAll(".helper-text.exemplos");

                if (localStorage.length !== 0 && !!localStorage.title && !!localStorage.bold && !!localStorage.boldparagraph) {
                titles.value = localStorage.title;
                palvNegritas.value = localStorage.bold;
                numPalvNegritas.value = localStorage.boldparagraph;
                listademarcadores.value = localStorage.list;
                palvItalicas.value = localStorage.italic;
                href.value = localStorage.link;
                palavraslink.value = localStorage.words;
                numParagfLink.value = localStorage.linkparagraph;
                descricao.value = localStorage.text;
                atributoslink.value = localStorage.atributo,                
                densidade.value = localStorage.densidade,
                totalpalavras.value = localStorage.totalpalavras;
                doc.getElementById('buttonLimpar').removeAttribute('disabled');
            }

            doc.getElementById('buttonConverter').addEventListener('click', function (el){
                el.preventDefault();
                var titulos = titles.value,
                    negrito = palvNegritas.value,
                    numParagrafosNegrito = numPalvNegritas.value,
                    list = listademarcadores.value,
                    italic = palvItalicas.value,
                    links = href.value,
                    palavras = palavraslink.value,
                    numParagrafosLink = numParagfLink.value,
                    text = descricao.value,
                    atributo = atributoslink.value,
                    textParagrafos;

                if(titulos !== '' && negrito !== '' && text !== ''){
                    // colocando os paragrafos no texto
                    text = text.trim().replace(/\n/g, '</p>\n<p>');
                    text = text.trim().replace(/\<p><\/p>/g, '');
                    textParagrafos = '<p>' + text;

                    // colocando os títulos no texto
                    var titlesArry = titulos.split('|');
                    titlesArry.map(function(title, index){
                        if (title.split('/')[1] == undefined) {
                            mensagemerro[0].style.color = "red";
                            window.scrollTo(0, mensagemerro[0].getBoundingClientRect().height);
                        }
                        var tag = title.split('/')[0].trim().toLowerCase();
                        var titulo = title.split('/')[1].trim();
                        if ( index === 0 ) {
                            text = text.replace(titulo + '</p>', '<' + tag + '>' + titulo +'</' + tag + '>\n');
                            ptrp = '<' + tag + '>' + titulo +'</' + tag + '>';
                        }
                        text = text.replace('<p>' + titulo + '</p>', '\n<' + tag + '>' + titulo +'</' + tag + '>\n');

                        textParagrafos = textParagrafos.replace('<p>' + titulo + '</p>', '');
                        mensagemerro[0].style.color = "rgba(0,0,0,0.54)";
                    });
                  
                    // colocando a lista com marcadores no texto
                    if(list !== ''){
                        var listArry = list.split('|');
                        var primeiro = 0;
                        listArry.map(function(li, index){
                            if (primeiro === index) {
                                text = text.replace(li+'</p>\n', '<ul><li>' + li + '</li>');
                                textParagrafos = textParagrafos.replace(li+'</p>\n', '<ul><li>' + li + '</li>');
                            } else if (li.indexOf(".") != -1){
                                text = text.replace('<p>'+li, '<li>' + li + '</li></ul>');
                                textParagrafos = textParagrafos.replace('<p>'+li, '<li>' + li + '</li></ul>');
                                primeiro = index +1;
                            } else {
                                text = text.replace('<p>'+li+'</p>\n', '<li>' + li + '</li>');
                                textParagrafos = textParagrafos.replace('<p>'+li+'</p>\n', '<li>' + li + '</li>');
                            }
                        });
                    }
                    textArry = textParagrafos.split('<p>');

                    var negritoArry = negrito.split('|'),
                        numParagrafosNegritoArry = numParagrafosNegrito.split('|'),
                        linksArry = links.split('|'),
                        palavrasArry = palavras.split('|'),
                        numParagrafosLinkArry = numParagrafosLink.split('|'),
                        atributosArry = atributo.split('|');

                    textArry.map(function(paragrafos, index) {
                        var parteTexto = paragrafos;
                        // colocando as palavras em negrito nos paragrafos
                        if(numParagrafosNegrito !== ''){
                            negritoArry.map(function(keys, palavra){
                                if(numParagrafosNegritoArry[palavra] == index) {
                                    paragrafos = paragrafos.replace(negritoArry[palavra], '<strong>' + negritoArry[palavra] + '</strong>');
                                }
                            });
                        } else if(numParagrafosNegrito === '') {
                            negritoArry.map(function(keys){
                                text = text.replace(new RegExp(keys, 'gi'), '<strong>' + keys + '</strong>');
                            });
                        }
                        // colocando os links nos paragrafos
                        linksArry.map(function (link, iLink){
                            if (atributo !== '' && atributosArry[iLink] !== 'null' && links !== '' && palavras !== '' && numParagrafosLink !== ''){
                                paragrafos = paragrafos.replace(palavrasArry[iLink], '<a href="' + link + '" target="_blank" style="text-decoration:underline;" rel="'+ atributosArry[iLink] +'">' + palavrasArry[iLink] + '</a>')
                            } else if(links !== '' && palavras !== '' && numParagrafosLink !== ''){
                                if(numParagrafosLinkArry[iLink] == index) {
                                    paragrafos = paragrafos.replace(palavrasArry[iLink], '<a href="' + link + '" target="_blank" style="text-decoration:underline;">' + palavrasArry[iLink] + '</a>')
                                }                                
                            } else if (links !== '' && palavras !== ''){
                                paragrafos = paragrafos.replace(new RegExp(palavrasArry[iLink], 'g'), '<a href="' + link + '" target="_blank" style="text-decoration:underline;">' + palavrasArry[iLink] + '</a>')
                            }
                        });
                        // colocando as palavras italicas no texto
                        if(italic !== ''){
                            var italicArry = italic.split('|');
                            italicArry.map(function(italico){
                                paragrafos = paragrafos.replace(new RegExp(italico, 'gi'), '<span style="font-style: italic;">' + italico + '</span>');
                            });
                        }
                        text = text.replace(parteTexto, paragrafos);
                    });

                    if(document.querySelector("#produto").checked == true) {
                        text = text.trim().replace(/\n\n\n/gi, '\n');
                        text = text.trim().replace(/\n\n/gi, '\n');
                        text = text.trim().replace(/\n/gi, '\n<br/>\n');
                        text = text.trim().replace(ptrp+'\n<br/>', '<style>\n.description ul {\n   list-style: disc;\n   padding-left: 19px;\n}\n</style>');
                    }
                    
                    text = text.trim().replace(new RegExp('</li>', 'gi'), '</li>\n');
                    text = text.trim().replace(new RegExp('<p><ul>', 'gi'), '<ul>');
                    text = text.trim().replace(new RegExp('</ul></p>', 'gi'), '</ul>');
                    
                    html_beautify(text);
                    doc.getElementById('codigohtml').value = text + '</p>';
                    doc.querySelector('.input-field.col.s12.conteudocatg').classList.add("codEfeito");
                    doc.getElementById('buttonLimpar').removeAttribute('disabled');

                    //salvando conteúdo
                    localStorage.title = titulos;
                    localStorage.bold = negrito;
                    localStorage.boldparagraph = numParagrafosNegrito;
                    localStorage.list = list;
                    localStorage.italic = italic;
                    localStorage.link = links;
                    localStorage.words = palavras;
                    localStorage.linkparagraph = numParagrafosLink;
                    localStorage.text = descricao.value;
                    localStorage.atributo = atributoslink.value;
                    localStorage.densidade = densidade.value;
                    localStorage.totalpalavras = totalpalavras.value;
                }
            });        
            doc.getElementById('buttonLimpar').addEventListener('click', function(limpa){
                limpa.preventDefault();
                titles.value = ''; titles.style.height = 0;
                palvNegritas.value = ''; palvNegritas.style.height = 0;
                numPalvNegritas.value = ''; numPalvNegritas.style.height = 0;
                listademarcadores.value = ''; listademarcadores.style.height = 0;
                palvItalicas.value = ''; palvItalicas.style.height = 0;
                href.value = ''; href.style.height = 0;
                palavraslink.value = ''; palavraslink.style.height = 0;
                numParagfLink.value = ''; numParagfLink.style.height = 0;
                descricao.value = ''; descricao.style.height = 0;                             
                densidade.value = ''; densidade.style.height = 0;
                totalpalavras.value = ''; totalpalavras.style.height = 0;
                doc.getElementById('codigohtml').value = '';
                doc.querySelector('.input-field.col.s12.conteudocatg').classList.remove("codEfeito");
                doc.getElementById('buttonLimpar').setAttribute('disabled', 'disabled');
            });

            var buttoMais = doc.querySelectorAll("[data-mais]");
            var conteudo = doc.querySelectorAll("[data-conteudo]");

            var clickMais = function(el) {
                el.preventDefault();
                var elclick = el.target || el.srcElement;
                var at = this.getAttribute("data-mais");

                this.classList.add("close");
                conteudo[at - 1].classList.add("conteudo-open");
            };
            [].forEach.call(buttoMais, function(el){
                el.addEventListener("click", clickMais, false);
            });

            doc.getElementById('codigohtml').addEventListener('contextmenu', function(el) {
                el.preventDefault();

                var linkImg = prompt("Digite o link da imagem:"),
                    alt = prompt("Digite o alt da imagem:"),
                    title = prompt("Digite o title da imagem:"),
                    longdesc = prompt("Digite a descrição da imagem:");

                imagem = doc.createElement('img');

                imagem.src = linkImg;
                imagem.alt = alt;
                imagem.title = title;
                imagem.longdesc = longdesc;

                var linhasArray = this.value.split('\n');
                var localclick = this.value.substr(0, this.selectionStart).split("\n").length;
                console.log(localclick);
                var totalpularlinhas = linhasArray.length;

                this.value = linhasArray.slice(0,localclick).join('\n') + '\n' + imagem.outerHTML + '\n\n' + linhasArray.slice(localclick,totalpularlinhas).join('\n');
            });
            doc.getElementById('calcular').addEventListener('click', function(el){
                el.preventDefault();
                // palavras-chaves 
                var palavras = descricao.value.replace(/(\r\n|\n|\r|,|"|\.|\?|!|\)|\(|_|:|;|')/g," ").trim();
                var stopwords = ['de','a','o','que','e','do','da','em','um','para','é','com','não','uma','os','no','se','na','por','mais','as','dos','como','mas','foi','ao','ele','das','tem','à','seu','sua','ou',
                'ser','quando','muito','há','nos','já','está','eu','também','só','pelo','pela','até','isso','ela','entre','era','depois','sem','mesmo','aos','ter','seus','quem','nas','me','esse','eles','estão',
                'você','tinha','foram','essa','num','nem','suas','meu','às','minha','têm','numa','pelos','elas','havia','seja','qual','será','nós','tenho','lhe','deles','essas','esses','pelas','este','fosse','dele',
                'tu','te','vocês','vos','lhes','meus','minhas','teu','tua','teus','tuas','nosso','nossa','nossos','nossas','dela','delas','esta','estes','estas','aquele','aquela','aqueles','aquelas','isto','aquilo',
                'estou','está','estamos','estão','estive','esteve','estivemos','estiveram','estava','estávamos','estavam','estivera','estivéramos','esteja','estejamos','estejam','estivesse','estivéssemos',
                'estivessem','estiver','estivermos','estiverem','hei','há','havemos','hão','houve','houvemos','houveram','houvera','houvéramos','haja','hajamos','hajam','houvesse','houvéssemos','houvessem','houver',
                'houvermos','houverem','houverei','houverá','houveremos','houverão','houveria','houveríamos','houveriam','sou','somos','são','era','éramos','eram','fui','foi','fomos','foram','fora','fôramos','seja',
                'sejamos','sejam','fosse','fôssemos','fossem','for','formos','forem','serei','será','seremos','serão','seria','seríamos','seriam','tenho','tem','temos','tém','tinha','tínhamos','tinham','tive','teve',
                'tivemos','tiveram','tivera','tivéramos','tenha','tenhamos','tenham','tivesse','tivéssemos','tivessem','tiver','tivermos','tiverem','terei','terá','teremos','terão','teria','teríamos','teriam'];
                var palavrasArry = palavras.toLowerCase().split(/\s+/g);
                stopwords.map(function(word){
                    var i = palavrasArry.indexOf(word);
                    while(i >= 0){
                        palavrasArry.splice(i, 1);
                        i = palavrasArry.indexOf(word);
                    }
                });
                var total = palavrasArry.length;
                var p, cont = 0;
                var densi = '';
                palavrasArry.map(function(palavra, index){
                    if (!densi.toLowerCase().includes(palavra.toLowerCase()) && palavra.length > 3){
                        p = descricao.value.split(palavra).length;
                        if (p > 3 && cont < 20) {
                            densi += palavra + ': ' + ((p/total)*100).toFixed(2) + '%\n';
                            cont++;
                        }
                    }
                });
                densidade.value = densi;
                totalpalavras.value = total;                              
                localStorage.densidade = densidade.value;
                localStorage.totalpalavras = totalpalavras.value;
            });
        </script>
    </body>
</html>