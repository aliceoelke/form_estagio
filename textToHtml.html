<style>
    .conteudo {
        margin: auto;
        max-width: 95%;
        width: 1200px;
    }
    .conteudo form.conteudocatg,
    .input-field.col.s12.conteudocatg {
        border: 1px solid #eee;
        border-radius: 4px;
        background-color: #fff;
        -webkit-box-shadow: 0 5px 5px 0 #ddd;
        box-shadow: 0 5px 5px 0 #ddd;
        padding: 20px;
        margin-top: 0;
    }
    #codigohtml {
        min-height: 100%;
        border: none;
        overflow-y: scroll;
    }
    .input-field.col.s12.conteudocatg{
        display: none;
    }
    .input-field.col.s12.conteudocatg.codEfeito {
        display: block;
    }
    .linksdotexto {
        border: 2px solid #000;
        float: left;
        border-radius: 4px;
        width: 100%;
        margin-bottom: 5px;
    }
    .conteudocatg textarea.materialize-textarea {
        z-index: 5000;
    }
    .mais-info {
        display: none;
    }
    .mais-info.conteudo-open {
        display: block;
    }
    .waves-effect.waves-light.btn.close {
        display: none;
    }
    span.btn {
        margin: 0 5px 5px;
        font-size: 12;
        padding: 0 6px;
    }
    .conteudo .conteudocatg .exemplos {
        width: 100%;
        display: inline-block;
        margin-top: -15px;
        margin-bottom: 15px;
        color: red;
        margin-left: 10px;
    }
</style>
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <title>Descrição do conteúdo</title>
    </head>
    <body>
        <div class="conteudo">
            <h3>Text to HTML</h3>
            <div class="row">
                <form class="conteudocatg col s6">
                    <div class="row">
                        <div class="input-field col s12">
                            <textarea class="materialize-textarea" name="" id="title"></textarea>
                            <label for="titulo">Título:</label>
                        </div>
                        <label class="exemplos">Ex.:H2 / Batata | H3 / Laranja Lima</label>
                        <div class="linksdotexto">
                            <div class="input-field col s12">                        
                                <textarea class="materialize-textarea" name="" id="negrito"></textarea>
                                <label for="negrito">Palavras em negrito:</label>
                            </div>
                            <label class="exemplos">Ex.:verde | azul | arroz</label>
                            <div class="input-field col s12">
                                <textarea class="materialize-textarea" name="" id="numPgfNegrito"></textarea>
                                <label for="numParagrafoNegrito">Nº Paragrafo:</label>
                            </div>
                            <label class="exemplos">Ex.:1 | 3 | 4</label>
                        </div>
                        <div class="linksdotexto">
                            <div class="input-field col s12">
                                <textarea class="materialize-textarea" name="" id="link"></textarea>
                                <label for="link">Links:</label>
                            </div>
                            <label class="exemplos">Ex.:https://www.exemplo.com.br/ | https://www.exemplo.com.br/teste/</label>
                            <div class="input-field col s12">
                                <textarea class="materialize-textarea" name="" id="palavra"></textarea>
                                <label for="palavra">Palavra:</label>
                            </div>
                            <label class="exemplos">Ex.:abacaxi | goiaba</label>
                            <span class="waves-effect waves-light btn" data-mais="1">Mais opções</span>
                            <div class="mais-info" data-conteudo="1">
                                <div class="input-field col s12">
                                    <textarea class="materialize-textarea" name="" id="numPgfLink"></textarea>
                                    <label for="numParagrafoLink">Nº Paragrafo:</label>
                                </div>
                                <label class="exemplos">Ex.:1 | 2 | 2</label>
                                <div class="input-field col s12">
                                    <textarea class="materialize-textarea" name="" id="atributos"></textarea>
                                    <label for="atributos">Atributos do link:</label>
                                </div>
                                <label class="exemplos">Ex.:nofollow | follow</label>
                            </div>
                        </div>
                        <div class="input-field col s12">
                            <textarea class="materialize-textarea" name="" id="text"></textarea>
                            <label for="texto">Descrição:</label>
                        </div>
                        <label class="exemplos">Cole o texto aqui.</label>
                        <span class="waves-effect waves-light btn" data-mais="2">Mais opções</span>
                        <div class="mais-info" data-conteudo="2">
                            <div class="input-field col s12">
                                <textarea class="materialize-textarea" name="" id="italic"></textarea>
                                <label for="italico">Palavras em italico:</label>
                            </div>
                            <label class="exemplos">Ex.: Bala | Bola | Bolo</label>
                            <div class="input-field col s12">
                                <textarea class="materialize-textarea" name="" id="list"></textarea>
                                <label for="lista">Lista com marcadores:</label>
                            </div>
                            <label class="exemplos">Ex.:texto exemplo;|texto exemplo rosa;|texto exemplo final.</label>
                            <div class="input-field col s12">
                                <textarea class="materialize-textarea" name="" id="list2"></textarea>
                                <label for="lista">Segunda lista com marcadores:</label>
                            </div>
                            <label class="exemplos">Ex.:amarelo exemplo;|bolacha exemplo rosa;|ida exemplo final.</label>
                            <div class="linksdotexto">
                                <div class="input-field col s12">
                                    <textarea class="materialize-textarea" name="" id="densidade"></textarea>
                                    <label for="densidade">Densidade das palavras:</label>
                                </div>
                                <div class="input-field col s12">
                                    <textarea class="materialize-textarea" name="" id="totalpalavras"></textarea>
                                    <label for="totalpalavras">Total das palavras:</label>
                                </div>
                                <button id="calcular" class="waves-effect waves-light btn">Calcular</button>
                            </div>
                        </div>
                    </div>
                    <button id="buttonConverter" class="waves-effect waves-light btn">Converter</button>
                    <button disabled id="buttonLimpar" class="waves-effect waves-light btn">Limpar campos</button>
                </form>
                <div class="col s6">
                    <div class="input-field col s12 conteudocatg">
                        <textarea class="materialize-textarea" name="" id="codigohtml"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="https://cdn.rawgit.com/beautify-web/js-beautify/v1.10.3/js/lib/beautify.js"></script>
        <script src="https://cdn.rawgit.com/beautify-web/js-beautify/v1.10.3/js/lib/beautify-css.js"></script>
        <script src="https://cdn.rawgit.com/beautify-web/js-beautify/v1.10.3/js/lib/beautify-html.js"></script>
        <script>
            var doc = document;
            var titles = doc.getElementById('title'),
                palvNegritas = doc.getElementById('negrito'),
                numPalvNegritas = doc.getElementById('numPgfNegrito'),
                listademarcadores = doc.getElementById('list'),
                lista2demarcadores = doc.getElementById('list2'),
                palvItalicas = doc.getElementById('italic'),
                href = doc.getElementById('link'),
                palavraslink = doc.getElementById('palavra'),
                numParagfLink = doc.getElementById('numPgfLink'),
                descricao = doc.getElementById('text'),
                atributoslink = doc.getElementById('atributos'),
                densidade = doc.getElementById('densidade'),
                totalpalavras = doc.getElementById('totalpalavras');

            if (localStorage.length !== 0 && !!localStorage.title && !!localStorage.bold && !!localStorage.boldparagraph) {
                titles.value = localStorage.title;
                palvNegritas.value = localStorage.bold;
                numPalvNegritas.value = localStorage.boldparagraph;
                listademarcadores.value = localStorage.list;
                lista2demarcadores.value = localStorage.list2;
                palvItalicas.value = localStorage.italic;
                href.value = localStorage.link;
                palavraslink.value = localStorage.words;
                numParagfLink.value = localStorage.linkparagraph;
                descricao.value = localStorage.text;
                atributoslink.value = localStorage.atributo,                
                densidade.value = localStorage.densidade,
                totalpalavras.value = localStorage.totalpalavras;
                doc.getElementById('buttonLimpar').removeAttribute('disabled');
            }

            doc.getElementById('buttonConverter').addEventListener('click', function (el){
                el.preventDefault();
                var titulos = titles.value,
                    negrito = palvNegritas.value,
                    numParagrafosNegrito = numPalvNegritas.value,
                    list = listademarcadores.value,
                    list2 = lista2demarcadores.value,
                    italic = palvItalicas.value,
                    links = href.value,
                    palavras = palavraslink.value,
                    numParagrafosLink = numParagfLink.value,
                    text = descricao.value,
                    atributo = atributoslink.value,
                    textParagrafos;

                if(titulos !== '' && negrito !== '' && text !== ''){
                    // colocando os paragrafos no texto
                    text = text.trim().replace(/\n/g, '</p>\n<p>');
                    text = text.trim().replace(/\<p><\/p>/g, '');
                    textParagrafos = '<p>' + text;
                    // colocando os títulos no texto
                    var titlesArry = titulos.split('|');
                    titlesArry.map(function(title, index){
                        var tag = title.split('/')[0].trim().toLowerCase();
                        var titulo = title.split('/')[1].trim();
                        if ( index === 0 ) {
                            text = text.replace(titulo + '</p>', '<' + tag + '>' + titulo +'</' + tag + '>\n');
                        }
                        text = text.replace('<p>' + titulo + '</p>', '\n<' + tag + '>' + titulo +'</' + tag + '>\n');

                        textParagrafos = textParagrafos.replace('<p>' + titulo + '</p>', '');
                    });
                  
                    // colocando a lista com marcadores no texto
                    if(list !== ''){
                        var listArry = list.split('|');
                        listArry.map(function(li, index){
                            if (index === 0) {
                                text = text.replace(li+'</p>', '<ul><li>' + li + '</li>\n\t\r');
                                textParagrafos = textParagrafos.replace(li+'</p>', '<ul><li>' + li + '</li>\n\t\r');
                            } else if ((listArry.length-1) === index){
                                text = text.replace('<p>'+li, '<li>' + li + '</li></ul>');
                                textParagrafos = textParagrafos.replace('<p>'+li, '<li>' + li + '</li></ul>');
                            } else {
                                text = text.replace('<p>'+li+'</p>', '<li>' + li + '</li>\n\t\r');
                                textParagrafos = textParagrafos.replace('<p>'+li+'</p>', '<li>' + li + '</li>\n\t\r');
                            }
                        });
                    }
                    if(list2 !== ''){
                        var list2Arry = list2.split('|');
                        list2Arry.map(function(li, index){
                            if (index === 0) {
                                text = text.replace(li+'</p>', '<ul><li>' + li + '</li>\n\t\r');
                                textParagrafos = textParagrafos.replace(li+'</p>', '<ul><li>' + li + '</li>\n\t\r');
                            } else if ((list2Arry.length-1) === index){
                                text = text.replace('<p>'+li, '<li>' + li + '</li></ul>');
                                textParagrafos = textParagrafos.replace('<p>'+li, '<li>' + li + '</li></ul>');
                            } else {
                                text = text.replace('<p>'+li+'</p>', '<li>' + li + '</li>\n\t\r');
                                textParagrafos = textParagrafos.replace('<p>'+li+'</p>', '<li>' + li + '</li>\n\t\r');
                            }
                        });
                    }

                    textArry = textParagrafos.split('<p>');

                    var negritoArry = negrito.split('|'),
                        numParagrafosNegritoArry = numParagrafosNegrito.split('|'),
                        linksArry = links.split('|'),
                        palavrasArry = palavras.split('|'),
                        numParagrafosLinkArry = numParagrafosLink.split('|'),
                        atributosArry = atributo.split('|');

                    textArry.map(function(paragrafos, index) {
                        var parteTexto = paragrafos;
                        // colocando as palavras em negrito nos paragrafos
                        if(numParagrafosNegrito !== ''){
                            negritoArry.map(function(keys, palavra){
                                if(numParagrafosNegritoArry[palavra] == index) {
                                    paragrafos = paragrafos.replace(negritoArry[palavra], '<strong>' + negritoArry[palavra] + '</strong>');
                                }
                            });
                        } else if(numParagrafosNegrito === '') {
                            negritoArry.map(function(keys){
                                text = text.replace(new RegExp(keys, 'gi'), '<strong>' + keys + '</strong>');
                            });
                        }
                        // colocando os links nos paragrafos
                        linksArry.map(function (link, iLink){
                            if (atributo !== '' && atributosArry[iLink] !== 'null' && links !== '' && palavras !== '' && numParagrafosLink !== ''){
                                paragrafos = paragrafos.replace(palavrasArry[iLink], '<a href="' + link + '" target="_blank" style="text-decoration:underline;" rel="'+ atributosArry[iLink] +'">' + palavrasArry[iLink] + '</a>')
                            } else if(links !== '' && palavras !== '' && numParagrafosLink !== ''){
                                if(numParagrafosLinkArry[iLink] == index) {
                                    paragrafos = paragrafos.replace(palavrasArry[iLink], '<a href="' + link + '" target="_blank" style="text-decoration:underline;">' + palavrasArry[iLink] + '</a>')
                                }                                
                            } else if (links !== '' && palavras !== ''){
                                paragrafos = paragrafos.replace(new RegExp(palavrasArry[iLink], 'g'), '<a href="' + link + '" target="_blank" style="text-decoration:underline;">' + palavrasArry[iLink] + '</a>')
                            }
                        });
                        // colocando as palavras italicas no texto
                        if(italic !== ''){
                            var italicArry = italic.split('|');
                            italicArry.map(function(italico){
                                paragrafos = paragrafos.replace(new RegExp(italico, 'gi'), '<span style="font-style: italic;">' + italico + '</span>');
                            });
                        }
                        text = text.replace(parteTexto, paragrafos);
                    });

                    html_beautify(text);
                    doc.getElementById('codigohtml').value = text + '</p>';
                    doc.querySelector('.input-field.col.s12.conteudocatg').classList.add("codEfeito");
                    doc.getElementById('buttonLimpar').removeAttribute('disabled');

                    //salvando conteúdo
                    localStorage.title = titulos;
                    localStorage.bold = negrito;
                    localStorage.boldparagraph = numParagrafosNegrito;
                    localStorage.list = list;
                    localStorage.list2 = list2;
                    localStorage.italic = italic;
                    localStorage.link = links;
                    localStorage.words = palavras;
                    localStorage.linkparagraph = numParagrafosLink;
                    localStorage.text = descricao.value;
                    localStorage.atributo = atributoslink.value;
                    localStorage.densidade = densidade.value;
                    localStorage.totalpalavras = totalpalavras.value;
                }
            });        
            doc.getElementById('buttonLimpar').addEventListener('click', function(limpa){
                limpa.preventDefault();
                titles.value = ''; titles.style.height = 0;
                palvNegritas.value = ''; palvNegritas.style.height = 0;
                numPalvNegritas.value = ''; numPalvNegritas.style.height = 0;
                listademarcadores.value = ''; listademarcadores.style.height = 0;
                lista2demarcadores.value = ''; lista2demarcadores.style.height = 0;
                palvItalicas.value = ''; palvItalicas.style.height = 0;
                href.value = ''; href.style.height = 0;
                palavraslink.value = ''; palavraslink.style.height = 0;
                numParagfLink.value = ''; numParagfLink.style.height = 0;
                descricao.value = ''; descricao.style.height = 0;                             
                densidade.value = ''; densidade.style.height = 0;
                totalpalavras.value = ''; totalpalavras.style.height = 0;
                doc.getElementById('codigohtml').value = '';
                doc.querySelector('.input-field.col.s12.conteudocatg').classList.remove("codEfeito");
                doc.getElementById('buttonLimpar').setAttribute('disabled', 'disabled');
            });

            var buttoMais = doc.querySelectorAll("[data-mais]");
            var conteudo = doc.querySelectorAll("[data-conteudo]");

            var clickMais = function(el) {
                el.preventDefault();
                var elclick = el.target || el.srcElement;
                var at = this.getAttribute("data-mais");

                this.classList.add("close");
                conteudo[at - 1].classList.add("conteudo-open");
            };
            [].forEach.call(buttoMais, function(el){
                el.addEventListener("click", clickMais, false);
            });

            doc.getElementById('codigohtml').addEventListener('contextmenu', function(el) {
                el.preventDefault();

                var linkImg = prompt("Digite o link da imagem:"),
                    alt = prompt("Digite o alt da imagem:"),
                    title = prompt("Digite o title da imagem:"),
                    longdesc = prompt("Digite a descrição da imagem:");

                imagem = doc.createElement('img');

                imagem.src = linkImg;
                imagem.alt = alt;
                imagem.title = title;
                imagem.longdesc = longdesc;

                var linhasArray = this.value.split('\n');
                var localclick = this.value.substr(0, this.selectionStart).split("\n").length;
                var totalpularlinhas = linhasArray.length;

                this.value = linhasArray.slice(0,localclick).join('\n') + '\n' + imagem.outerHTML + '\n\n' + linhasArray.slice(localclick,totalpularlinhas).join('\n');
            });
            doc.getElementById('calcular').addEventListener('click', function(el){
                el.preventDefault();
                // palavras-chaves 
                var palavras = descricao.value.replace(/(\r\n|\n|\r|,|"|\.|\?|!|\)|\(|_|:|;|')/g," ").trim();
                var stopWorks = ['a','agora','ainda','alguém','algum','alguma','algumas','alguns','ampla','amplas','amplo','amplos','ante','antes','ao','aos','após','aquela','aquelas','aquele','aqueles','aquilo','as','até, através, cada, coisa, coisas, com, como, contra, contudo, da, daquele, daqueles, das, de, dela, delas, dele, deles, depois, dessa, dessas, desse, desses, desta, destas, deste, deste, destes, deve, devem, devendo, dever, deverá, deverão, deveria, deveriam, devia, deviam, disse, disso, disto, dito, diz, dizem, do, dos, e, é, ela, elas, ele, eles, em, enquanto, entre, era, essa, essas, esse, esses, esta, está, estamos, estão, estas, estava, estavam, estávamos, este, estes, estou, eu, fazendo, fazer, feita, feitas, feito, feitos, foi, for, foram, fosse, fossem, grande, grandes, há, isso, isto, já, la, lá, lhe, lhes, lo, mas, me, mesma, mesmas, mesmo, mesmos, meu, meus, minha, minhas, muita, muitas, muito, muitos, na, não, nas, nem, nenhum, nessa, nessas, nesta, nestas, ninguém, no, nos, nós, nossa, nossas, nosso, nossos, num, numa, nunca, o, os, ou, outra, outras, outro, outros, para, pela, pelas, pelo, pelos, pequena, pequenas, pequeno, pequenos, per, perante, pode, pude, podendo, poder, poderia, poderiam, podia, podiam, pois, por, porém, porque, posso, pouca, poucas, pouco, poucos, primeiro, primeiros, própria, próprias, próprio, próprios, quais, qual, quando, quanto, quantos, que, quem, são, se, seja, sejam, sem, sempre, sendo, será, serão, seu, seus, si, sido, só, sob, sobre, sua, suas, talvez, também, tampouco, te, tem, tendo, tenha, ter, teu, teus, ti, tido, tinha, tinham, toda, todas, todavia, todo, todos, tu, tua, tuas, tudo, última, últimas, último, últimos, um, uma, umas, uns, vendo, ver, vez, vindo, vir, vos, vós']
                var palavrasArry = palavras.split(/\s+/g);
                var total = palavrasArry.length;
                var p, cont = 0;
                var densi = '';
                palavrasArry.map(function(palavra, index){
                    if (!densi.toLowerCase().includes(palavra.toLowerCase()) && palavra.length > 3){
                        p = descricao.value.split(palavra).length;
                        if ( p > 3 && cont < 20) {
                            densi += '\n' + palavra + ': ' + (p/total);
                            cont++;
                        }
                    }
                });
                densidade.value = densi;
                totalpalavras.value = total;                              
                localStorage.densidade = densidade.value;
                localStorage.totalpalavras = totalpalavras.value;
            });
        </script>
    </body>
</html>